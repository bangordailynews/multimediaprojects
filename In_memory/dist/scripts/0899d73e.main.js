function sizeFunctions(){var a=document.getElementById("intro"),b=document.getElementById("poster-slide");$.contains(a,b)&&$("#intro").css({width:$(window).width(),height:$(window).height()})}function sendGoogleAnalyticsEvent(a,b,c){console.log("sendGoogleAnalyticsEvent : "+a+","+b+","+c),c="undefined"!=typeof c?c:null,ga("send",{hitType:"event",eventCategory:"In_memory",eventAction:a,eventLabel:b,eventValue:c})}function setUpVideos(a){$("video").each(function(b,c){a[$(this).get(0).id]=videojs($(this).get(0).id)}),$(".video-media").bind("mouseenter",function(){0===a[$(this).find(".video-js").get(0).id].currentTime()&&a[$(this).find(".video-js").get(0).id].play()});for(var b in a)a.hasOwnProperty(b)&&"big-video-vid_html5_api"!==b&&(a[b].on("play",function(){a[b].currentTime()>0?sendGoogleAnalyticsEvent("Resumed Video",a[b].id()):sendGoogleAnalyticsEvent("Started Video",a[b].id())}),a[b].on("ended",function(){sendGoogleAnalyticsEvent("Completed Video",a[b].id())}),a[b].on("pause",function(){sendGoogleAnalyticsEvent("Paused Video",a[b].id(),a[b].currentTime())}))}function setUpAmbientVideos(a){$(".ambient_video").each(function(b,c){var d=new Object;d.ID=$(this).attr("id"),d.video=$(this).attr("data-video"),d.image=$(this).attr("data-static"),a[d.ID]=new $.BigVideo({container:$(this).parents(".cards"),shrinkable:!0,useFlashForFirefox:!1}),a[d.ID].init(),Modernizr.touch?a[d.ID].show(d.image):a[d.ID].show(d.video,{ambient:!0}),$(this).parents(".cards").addClass("ambient-video-background"),$(this).remove()})}function setUpImages(a){var b=$(this).offsetParent().attr("id");Modernizr.touch?$("img.lazy").lazyload({threshold:1e3,effect:"fadeIn",failure_limit:100,load:function(){b&&sendGoogleAnalyticsEvent("Image Load",a.name+"-"+b,1)}}):$("img.lazy").lazyload({effect:"fadeIn",load:function(){b&&sendGoogleAnalyticsEvent("Image Load",a.name+"-"+b,1)}})}function setUpChapters(a,b){var c=Handlebars.compile($("#card-template").html());$.each(a.chapters,function(a,d){d.index=parseInt(a)+1,d.chapterName=b.machineName,console.log("# chapter: "+d.chapterName+": sub-chapter: "+d.index),console.log(d),$("#chapters").append(c(d))}),$.each($(".cards a"),function(){$(this).attr("target","_blank")})}function setUpAds(machineName){$('<div class="rich-media size-medium ad orientation-right"><div id="bdnads-top-300x600"></div></div>').insertAfter($("#card-"+machineName+"-3 p.text:nth-last-of-type(6)").first()),googletag.cmd.push(function(){googletag.display("bdnads-top-300x600")});for(var i=1;5>i;i++)$('<div class="rich-media size-medium ad orientation-left"><div id="bdnads-bottom-300x250-'+i+'"></div></div>').insertAfter($("#card-"+machineName+"-"+eval(3+i)+" p.text:nth-last-of-type(4)").first()),googletag.cmd.push(function(){googletag.display("bdnads-bottom-300x250-"+i)});$(".ad").prepend("<h6><span>Story continues after </span>Paid Advertisement</h6>"),$(".comment-call-to-action").click(function(){$(this).toggle(),$(".fb-comments").toggle()})}function appendNextLink(a,b){if("undefined"!=typeof a[b.count+1]){var c='<p class="text"><span class="glyphicon glyphicon-chevron-right"></span> <em><a href="?'+a[b.count+1].slug+'">Up next</a>: Read on in: <a href="?'+a[b.count+1].slug+'"> '+a[b.count+1].nav_name.regular+".</a></em></p>";$(" .cards:last-of-type ").append(c)}}function appendCommentsLinkToPullquotes(){var a='<a href="#comments"><span class="glyphicon glyphicon-comments"></span> Share your thoughts.</a>';$(".pullquote .caption").append(a),$(".pullquote .caption").on("click",function(){window.location.hash="comments"})}Handlebars.registerHelper("multimedia",function(a){"use strict";if(this.filename)if("video"===this.filetype){var b=this.filename.split("/"),c=b[b.length-1],d=c.split(".");this.fileID=d[0]}else{var b=this.filename.split(".");this.fileID=b[0].replace(/ |:|\//g,"-")}else this.fileID="";switch(this.caption||this.credit&&"text"!==this.filetype?(this.caption=this.caption?this.caption:"",this.captionFormatted='<p class="caption">'+this.caption+' <span class="credit">'+this.credit+"</span></p>"):this.captionFormatted="",this.filetype){case"text":return'<p class="text">'+this.caption+"</p>";case"list":return this.caption;case"video":return'<div class="rich-media video-media size-'+this.size+" orientation-"+this.orientation+'"><div class="embed-responsive embed-responsive-16by9"><video id="video-'+this.fileID+'" controls autoWidth="true" autoHeight="true" class="embed-responsive-item video video-js vjs-default-skin" poster="images/'+this.poster+'"><source type="video/mp4" src="'+this.filename+'" /></video></div>'+this.captionFormatted+"</div>";case"youtube":return Modernizr.touch?'<div class="embed-responsive embed-responsive-16by9 rich-media video-media size-'+this.size+" orientation-"+this.orientation+'"><video id="video-'+this.fileID+'" autoWidth="true" autoHeight="true" class="embed-responsive-item video video-js vjs-default-skin"data-setup=\'{ "techOrder": ["youtube"], "sources": [{ "type": "video/youtube", "src": "'+this.filename+'"}], "Youtube": { "ytControls": 2 }}\'></video></div>':'<div class="embed-responsive embed-responsive-16by9 rich-media video-media size-'+this.size+" orientation-"+this.orientation+'"><video id="video-'+this.fileID+'" controls autoWidth="true" autoHeight="true" class="embed-responsive-item video video-js vjs-default-skin" poster="images/'+this.poster+'"data-setup=\'{ "techOrder": ["youtube"], "sources": [{ "type": "video/youtube", "src": "'+this.filename+"\"}]}'></video></div>";case"photo":return'<div id="photo-'+this.fileID+'" class="rich-media photo size-'+this.size+" orientation-"+this.orientation+'"><a href="images/'+this.filename+'"><img class="lazy" data-original="images/'+this.filename+'" alt="'+this.caption+'" /></a>'+this.captionFormatted+"</div>";case"graphic":return'<div id="graphic-'+this.fileID+'" class="rich-media photo graphic size-'+this.size+" orientation-"+this.orientation+'"><a href="images/'+this.filename+'"><img class="lazy" data-original="images/'+this.filename+'" alt="'+this.caption+'" /></a><p class="caption">'+this.caption+"</p></div>";case"pullquote":return'<div class="rich-media pullquote size-'+this.size+" orientation-"+this.orientation+'"><p class="caption">'+this.caption+"</p></div>";case"tableau_1":var e="<div class='tableauPlaceholder' id='viz1479234446577' style='position: relative'><noscript><a href='#'><img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ma&#47;MapofPopulationChangeinMaine&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz' style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='site_root' value='' /><param name='name' value='MapofPopulationChangeinMaine&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='no' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Ma&#47;MapofPopulationChangeinMaine&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /></object></div> <script type='text/javascript'> var divElement = document.getElementById('viz1479234446577'); var vizElement = divElement.getElementsByTagName('object')[0]; vizElement.style.width='654px';vizElement.style.height='760px'; var scriptElement = document.createElement('script'); scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js'; vizElement.parentNode.insertBefore(scriptElement, vizElement); </script>";return e;case"tableau_2":var e="<div class='tableauPlaceholder' id='viz1479483225225' style='position: relative'><noscript><a href='#'><img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Wo&#47;Workingagepopulation_0&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz' style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='site_root' value='' /><param name='name' value='Workingagepopulation_0&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Wo&#47;Workingagepopulation_0&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /></object></div> <script type='text/javascript'> var divElement = document.getElementById('viz1479483225225'); var vizElement = divElement.getElementsByTagName('object')[0]; vizElement.style.minWidth='324px';vizElement.style.maxWidth='654px';vizElement.style.width='100%';vizElement.style.minHeight='529px';vizElement.style.maxHeight='629px';vizElement.style.height=(divElement.offsetWidth*0.75)+'px'; var scriptElement = document.createElement('script'); scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js'; vizElement.parentNode.insertBefore(scriptElement, vizElement); </script>";return e;case"GoogleChart":return'<iframe src="https://docs.google.com/spreadsheets/d/1O_eWRO0azEzpiksoiMUIhpmAd4k57KLQ3SAW5ouy2II/pubchart?oid=384629986&amp;format=interactive" id="iFrame1"></iframe>';default:return}}),$(function(){var a={};sizeFunctions(),$.getJSON("data/chapters.json",function(b){console.log(b);var c=b[0];c.count=0,$.each(b,function(a,d){b[a].machineName=d.name.replace(/ /g,"-").toLowerCase(),location.href.indexOf(d.name)>0&&(c=d,c.count=a,$('a[href="?Intro"]').parent().removeClass("active"),$('a[href="?'+d.name+'"]').parent().addClass("active"))});var d=Handlebars.compile($("#head-template").html());$("#intro").append(d(c)),sizeFunctions(),console.log("Displaying "+c.name),$.getJSON("data/"+c.machineName+".json",function(d){setUpChapters(d,c),setUpImages(c),setUpVideos(a),setUpAds(c.machineName),$(".hide-after-chapters").addClass("hidden"),$("#card-"+c.machineName+"-2 h2:first-of-type").after('<div class="byline">By '+c.byline+"</div>");var e='<div class="addthis_toolbox addthis_default_style addthis_32x32_style"><a class="addthis_button_email">E-mail</a><a class="addthis_button_facebook">Share</a><a class="addthis_button_twitter">Tweet</a></div>';$(".footer .row > div:first-of-type").prepend('<div class="byline">'+e+"</div>"),$("#card-"+c.machineName+"-2 h2:first-of-type").before('<h1 class="displayChapter">'+c.name+"</h1>"),-1!==c.poster.indexOf(".")?$("#intro #poster-slide").css({background:'no-repeat center center url("images/'+c.poster+'")',"background-size":"cover"}):$("#intro #poster-slide").css({background:'no-repeat center center url("images/'+c.poster+'.jpg")',"background-size":"cover"}),addthis.init(),appendCommentsLinkToPullquotes(),appendNextLink(b,c),$(".show-after-chapters.hidden").removeClass("hidden")})}),$.fn.isOnScreen=function(){var a=$(window),b={top:a.scrollTop(),left:a.scrollLeft()};b.right=b.left+a.width(),b.bottom=b.top+a.height();var c=this.offset();return c.right=c.left+this.outerWidth(),c.bottom=c.top+this.outerHeight(),!(b.right<c.left||b.left>c.right||b.bottom<c.top||b.top>c.bottom)},$(window).scroll(function(){$(".rich-media .video-js").each(function(b,c){$(this).isOnScreen()===!1&&a[$(this).attr("id")].pause()}),$(".scroll-cue").fadeOut(),$.doTimeout("scroll",1e3,function(){$(window).scrollTop()+$(window).height()<$(document).height()&&!$(".video-js").hasClass("vjs-playing")&&$(".scroll-cue").fadeIn(600)})}),$(window).resize(function(){sizeFunctions()})});